<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Untitled Page</title>
    <script type="text/javascript" src="../Resources/plugins/jquery/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="../Resources/plugins/layer/layer.min.js"></script>
    <script type="text/javascript" src="../Resources/plugins/svg/svg.js"></script>
    <script type="text/javascript" src="../Resources/js/svgHelper.js"></script>
    <script type="text/javascript">

        $(function ($) {
        });
        var indexside = 0;
        var indexpage = 0;
        window.onload = function () {
            window.setInterval(test, 666);

            getCanvas1().find("*[inkscape\\:label=故障信息],*[inkscape\\:label=传输记录]").css("cursor", "pointer");

            // 注册SVG元素脚本事件
            getCanvas1().find("*[inkscape\\:label=故障信息]").bind("click", function () {
                // 打开故障信息
                ShowHitchs('#1CYG');
            });
            getCanvas1().find("*[inkscape\\:label=传输记录]").bind("click", function () {
                // 打开样瓶传输记录
                ShowCygControlCmd();
            });

            changeColorFill(getCanvas1().find("*[inkscape\\:label=一区_c]"), "#00a551");
            getCanvas1().find("*[inkscape\\:label=一区],*[inkscape\\:label=一区_c]").css("cursor", "pointer");
            getCanvas1().find("*[inkscape\\:label=一区],*[inkscape\\:label=一区_c]").bind("click", function () {
                // 一区fill:url(#linearGradient5653)
                indexpage = 0;
                reloadBox();
                changeColorFill(getCanvas1().find("*[inkscape\\:label=一区_c]"), "#00a551");
                changeColorFill(getCanvas1().find("*[inkscape\\:label=二区_c],*[inkscape\\:label=三区_c],*[inkscape\\:label=四区_c],*[inkscape\\:label=五区_c]"), "black");
            });
            getCanvas1().find("*[inkscape\\:label=二区],*[inkscape\\:label=二区_c]").css("cursor", "pointer");
            getCanvas1().find("*[inkscape\\:label=二区],*[inkscape\\:label=二区_c]").bind("click", function () {
                // 二区
                indexpage = 1;
                reloadBox();
                changeColorFill(getCanvas1().find("*[inkscape\\:label=二区_c]"), "#00a551");
                changeColorFill(getCanvas1().find("*[inkscape\\:label=一区_c],*[inkscape\\:label=三区_c],*[inkscape\\:label=四区_c],*[inkscape\\:label=五区_c]"), "black");
            });
            getCanvas1().find("*[inkscape\\:label=三区],*[inkscape\\:label=三区_c]").css("cursor", "pointer");
            getCanvas1().find("*[inkscape\\:label=三区],*[inkscape\\:label=三区_c]").bind("click", function () {
                // 三区
                indexpage = 2;
                reloadBox();
                changeColorFill(getCanvas1().find("*[inkscape\\:label=三区_c]"), "#00a551");
                changeColorFill(getCanvas1().find("*[inkscape\\:label=一区_c],*[inkscape\\:label=二区_c],*[inkscape\\:label=四区_c],*[inkscape\\:label=五区_c]"), "black");
            });
            getCanvas1().find("*[inkscape\\:label=四区],*[inkscape\\:label=四区_c]").css("cursor", "pointer");
            getCanvas1().find("*[inkscape\\:label=四区],*[inkscape\\:label=四区_c]").bind("click", function () {
                // 四区
                indexpage = 3;
                reloadBox();
                changeColorFill(getCanvas1().find("*[inkscape\\:label=四区_c]"), "#00a551");
                changeColorFill(getCanvas1().find("*[inkscape\\:label=一区_c],*[inkscape\\:label=二区_c],*[inkscape\\:label=三区_c],*[inkscape\\:label=五区_c]"), "black");
            });
            getCanvas1().find("*[inkscape\\:label=五区],*[inkscape\\:label=五区_c]").css("cursor", "pointer");
            getCanvas1().find("*[inkscape\\:label=五区],*[inkscape\\:label=五区_c]").bind("click", function () {
                // 五区
                indexpage = 4;
                reloadBox();
                changeColorFill(getCanvas1().find("*[inkscape\\:label=五区_c]"), "#00a551");
                changeColorFill(getCanvas1().find("*[inkscape\\:label=一区_c],*[inkscape\\:label=二区_c],*[inkscape\\:label=三区_c],*[inkscape\\:label=四区_c]"), "black");
            });
            getCanvas1().find("*[inkscape\\:label=1A柜],*[inkscape\\:label=1A柜_c]").css("cursor", "pointer");
            getCanvas1().find("*[inkscape\\:label=1A柜],*[inkscape\\:label=1A柜_c]").bind("click", function () {
                // 1A柜
                indexside = 0;
                reloadBox();
                changeColorFill(getCanvas1().find("*[inkscape\\:label=1A柜_c]"), "#00a551");
                changeColorFill(getCanvas1().find("*[inkscape\\:label=1B柜_c]"), "#404041");
                changeColorFill(getCanvas1().find("*[inkscape\\:label=2A柜_c]"), "#404041");
                changeColorFill(getCanvas1().find("*[inkscape\\:label=2B柜_c]"), "#404041");
            });
            getCanvas1().find("*[inkscape\\:label=1B柜],*[inkscape\\:label=1B柜_c]").css("cursor", "pointer");
            getCanvas1().find("*[inkscape\\:label=1B柜],*[inkscape\\:label=1B柜_c]").bind("click", function () {
                // 1B柜
                indexside = 1;
                reloadBox();
                changeColorFill(getCanvas1().find("*[inkscape\\:label=1A柜_c]"), "#404041");
                changeColorFill(getCanvas1().find("*[inkscape\\:label=1B柜_c]"), "#00a551");

                changeColorFill(getCanvas1().find("*[inkscape\\:label=2A柜_c]"), "#404041");
                changeColorFill(getCanvas1().find("*[inkscape\\:label=2B柜_c]"), "#404041");
            });

            getCanvas1().find("*[inkscape\\:label=2A柜],*[inkscape\\:label=2A柜_c]").css("cursor", "pointer");
            getCanvas1().find("*[inkscape\\:label=2A柜],*[inkscape\\:label=2A柜_c]").bind("click", function () {
                // 2A柜
                indexside = 2;
                reloadBox();
                changeColorFill(getCanvas1().find("*[inkscape\\:label=2A柜_c]"), "#00a551");
                changeColorFill(getCanvas1().find("*[inkscape\\:label=2B柜_c]"), "#404041");

                changeColorFill(getCanvas1().find("*[inkscape\\:label=1A柜_c]"), "#404041");
                changeColorFill(getCanvas1().find("*[inkscape\\:label=1B柜_c]"), "#404041");
            });
            getCanvas1().find("*[inkscape\\:label=2B柜],*[inkscape\\:label=2B柜_c]").css("cursor", "pointer");
            getCanvas1().find("*[inkscape\\:label=2B柜],*[inkscape\\:label=2B柜_c]").bind("click", function () {
                // 2B柜
                indexside = 3;
                reloadBox();
                changeColorFill(getCanvas1().find("*[inkscape\\:label=2A柜_c]"), "#404041");
                changeColorFill(getCanvas1().find("*[inkscape\\:label=2B柜_c]"), "#00a551");

                changeColorFill(getCanvas1().find("*[inkscape\\:label=1A柜_c]"), "#404041");
                changeColorFill(getCanvas1().find("*[inkscape\\:label=1B柜_c]"), "#404041");
            });
        };
        function initpage() {
            dataHandler({ Key: "四项转换器", Type: "9999", Value: 3 });
            dataHandler({ Key: "二项转换器", Type: "9998", Value: 2 });
        }
        function LoadSamInfo(datas) {
            tempboxdatas = datas;
            reloadBox();
        }

        // 改变颜色
        // $element:SVG.jQuery对象
        // color:颜色
        function changeColorFill($elements, color) {
            $elements.each(function () {
                var $this = $(this);
                $this.css({ "fill": color });
            });
        }

        var tempboxdatas;
        function reloadBox() {
            var g = 0 + 132 * (indexside * 5 + indexpage);
            //            var g = 0 ;
            var temp = "";
            for (var j = 0; j < 12; j++) {
                for (var i = 0; i < 11; i++) {
                    temp = temp += "<div style='position: absolute;width: 50px; height: 22px;left:" + 55 * (i + 1) + "px;top:" + (27 * j + 5) + "px; background-color: " + (tempboxdatas[g].Type == "1" ? "#00a551" : (tempboxdatas[g].Type == "0" ? "#ec1c24" : "#a6a8ab")) + ";'><label style='font-size: 12px; top:3px; left:6px;position: absolute;text-align: center;'>" + tempboxdatas[g++].Name + "</label></div>";
                }
            }
            $('#sambox').html(temp);
        }
        // 获取SVG jquery对象
        function getSVGjQuery(id) {
            return $(document.getElementById(id).getSVGDocument())
        }

        // 获取 svgCanvas1 SVG jquery对象
        function getCanvas1() {
            return getSVGjQuery("svgCanvas1");
        }

        function StartTwinkle() {
            alert(example.getDateTime());
        }

        function StartTwinkle2() {
            alert(example.showConform("确定要删除？"));
        }

        // 请求数据 - 后台调用
        function requestData(datas) {
            for (var i = 0; i < datas.length; i++) {
                dataHandler(datas[i]);
            }
        }

        var angle = 1;
        // 处理数据
        function dataHandler(data) {

            try {
                // key_value
                if (data.Type == 0)
                    if (data.Tag == "ShowDiv")
                        CaclDiv($("#" + data.Key), data.Value, data.Value2);
                    else
                        $("#" + data.Key).html(data.Value);
                // json_data
                else if (data.Type == 1) {
                    if (data.Key == "采样机1_集样罐" || data.Key == "采样机2_集样罐") loadBarrels(data);
                }
                // svg_text
                else if (data.Type == 2) {
                    getCanvas1().find("*[inkscape\\:label=" + data.Key + "]").html(data.Value);
                }
                // svg_color
                else if (data.Type == 3) {
                    svgChangeColor(getCanvas1().find("*[inkscape\\:label=" + data.Key + "]"), data.Value);
                }
                // svg_blinkcolor
                else if (data.Type == 7) {
                    svgChangeColor(getCanvas1().find("*[inkscape\\:label=" + data.Key + "]"), data.Value);

                    if (data.Value == "#00C000" || data.Value == "Red") {

                        getCanvas1().find("*[inkscape\\:label=" + data.Key + "]").animate({ opacity: 0.25 }, 1000);

                        getCanvas1().find("*[inkscape\\:label=" + data.Key + "]").animate({ opacity: 1 }, 1000);
                    }
                }
                // svg_scroll
                else if (data.Type == 9999) {
                    if (data.Value == 1) {
                        changeScroll(getCanvas1().find("*[inkscape\\:label=" + data.Key + "]"), "-25,200.04816,157.75323");
                        changeColor1(getCanvas1().find("*[inkscape\\:label=c1]"), "#ee4036");
                        changeColor1(getCanvas1().find("*[inkscape\\:label=c2],*[inkscape\\:label=c3],*[inkscape\\:label=c4]"), "#ffffff");
                    } if (data.Value == 2) {
                        changeScroll(getCanvas1().find("*[inkscape\\:label=" + data.Key + "]"), "-12,200.04816,157.75323");
                        changeColor1(getCanvas1().find("*[inkscape\\:label=c2]"), "#ee4036");
                        changeColor1(getCanvas1().find("*[inkscape\\:label=c1],*[inkscape\\:label=c3],*[inkscape\\:label=c4]"), "#ffffff");
                    } if (data.Value == 3) {
                        changeScroll(getCanvas1().find("*[inkscape\\:label=" + data.Key + "]"), "0,200.04816,157.75323");
                        changeColor1(getCanvas1().find("*[inkscape\\:label=c3]"), "#ee4036");
                        changeColor1(getCanvas1().find("*[inkscape\\:label=c2],*[inkscape\\:label=c1],*[inkscape\\:label=c4]"), "#ffffff");
                    } if (data.Value == 4) {
                        changeScroll(getCanvas1().find("*[inkscape\\:label=" + data.Key + "]"), "12,200.04816,157.75323");
                        changeColor1(getCanvas1().find("*[inkscape\\:label=c4]"), "#ee4036");
                        changeColor1(getCanvas1().find("*[inkscape\\:label=c2],*[inkscape\\:label=c3],*[inkscape\\:label=c1]"), "#ffffff");
                    }
                }
                // svg_scroll
                else if (data.Type == 9998) {
                    if (data.Value == 1) {
                        changeScroll(getCanvas1().find("*[inkscape\\:label=" + data.Key + "]"), "-12,477.5,219");
                    } if (data.Value == 2) {
                        changeScroll(getCanvas1().find("*[inkscape\\:label=" + data.Key + "]"), "0,477.5,219");
                    }
                }
                // svg_scroll
                else if (data.Type == 10000) {
                    tempstrs = data.Value;
                }
            } catch (e) {
                //alert(e.Message);
            }
        }
        var newtimes = new Array("自动存查样管理系统", "化验室", "弃样工作站", "制样机1");
        // 测试
        var tempnums = 0;
        var tempstrs = "";
        function test() {
            if (tempstrs != "") {
                changeColor1(getCanvas1().find("*[inkscape\\:label=风机]"), "#ec1c24");
            }

            var needchange = "";
            var needchange1 = "";
            var needchange2 = "";
            var noneedchange = "";
            var noneedchange1 = "";
            for (var i = 0; i < newtimes.length; i++) {
                if (tempstrs.indexOf(newtimes[i]) >= 0) {
                    needchange = needchange + "*[inkscape\\:label=" + newtimes[i] + "],";
                    needchange1 = needchange1 + "*[inkscape\\:label=" + newtimes[i] + "1],";
                    needchange2 = needchange2 + "*[inkscape\\:label=" + newtimes[i] + "2],";
                    if (tempstrs.indexOf(newtimes[i]) > 0) {
                        if (newtimes[i] == "自动存查样管理系统") {
                            dataHandler({ Key: "三项转换器", Type: "9999", Value: "4" });
                        }
                        else if (newtimes[i] == "化验室") {
                            dataHandler({ Key: "三项转换器", Type: "9999", Value: "1" });
                        }
                        else if (newtimes[i] == "弃样工作站") {
                            dataHandler({ Key: "三项转换器", Type: "9999", Value: "2" });
                        }
                        else if (newtimes[i] == "制样机1") {
                            dataHandler({ Key: "三项转换器", Type: "9999", Value: "3" });
                        }
                    }
                }
                else {
                    noneedchange = noneedchange + "*[inkscape\\:label=" + newtimes[i] + "],";
                    noneedchange1 = noneedchange1 + "*[inkscape\\:label=" + newtimes[i] + "1],*[inkscape\\:label=" + newtimes[i] + "2],";
                }
            }
            changeColor1(getCanvas1().find(needchange.substring(0, needchange.length - 1)), "#ec1c24");
            if (tempnums % 2 == 0) {
                changeColor1(getCanvas1().find(needchange1.substring(0, needchange1.length - 1)), "#ec1c24");
                changeColor1(getCanvas1().find(needchange2.substring(0, needchange2.length - 1)), "#d0d2d3");
            }
            else {
                changeColor1(getCanvas1().find(needchange1.substring(0, needchange1.length - 1)), "#d0d2d3");
                changeColor1(getCanvas1().find(needchange2.substring(0, needchange2.length - 1)), "#ec1c24");

            }
            changeColor1(getCanvas1().find(noneedchange.substring(0, noneedchange.length - 1)), "#00a551");
            changeColor1(getCanvas1().find(noneedchange1.substring(0, noneedchange1.length - 1)), "#d0d2d3");

            tempnums++;
        }

        function test1() {

            getCanvas1().find("*[inkscape\\:label=路径探测器36]").animate({ opacity: 0.25 }, 1000);

            getCanvas1().find("*[inkscape\\:label=路劲探测器36]").animate({ opacity: 1 }, 1000);
        }

        //显示div存样信息
        function CaclDiv(divObj, exist, pass) {
            divObj.children().eq(0).css("height", (224 - pass - exist) * divObj.height() / 224);
            divObj.children().eq(1).css("height", pass * divObj.height() / 224);
            divObj.children().eq(2).css("height", exist * divObj.height() / 224);
        }

        // 测试 改变颜色
        function testColor() {
            //dataHandler({ Key: "风机", Type: "3", Value: "Red" });
        }

        //加载样品传输信息
        function LoadSampleInfo(datas) {
            for (var nums = 1; nums <= 8; nums++) {
                getCanvas1().find("*[inkscape\\:label=UpdateTime" + nums + "]").html(datas[nums - 1].UpdateTime);
                getCanvas1().find("*[inkscape\\:label=Code" + nums + "]").html(datas[nums - 1].Code);
                getCanvas1().find("*[inkscape\\:label=SamType" + nums + "]").html(datas[nums - 1].SamType);
                getCanvas1().find("*[inkscape\\:label=Status" + nums + "]").html(datas[nums - 1].Status);
            }
        }

        //显示异常信息
        function ShowHitchs(param) {
            var res = AutoCupboardV8Cef.GetHitchs(param);
        }

        //显示传输记录
        function ShowCygControlCmd() {
            var res = AutoCupboardV8Cef.ShowCygControlCmd();
        }
     
    </script>
    <style type="text/css">
        html, body
        {
            margin: 0px;
            padding: 0px;
            font-family: 微软雅黑;
            background-color: rgb(0, 0, 0);
        }
        .div-root
        {
            position: relative;
            margin: 0px auto;
            width: 100%;
            overflow: hidden;
            text-align: center;
        }
        .divMain
        {
            position: absolute;
            top: 455px;
            left: 950px;
            width: 583px;
            height: 241px;
            overflow: hidden;
            border: 1px solid #5C6065;
        }
        .button1
        {
            position: absolute;
            width: 70px;
            height: 23px;
            font-family: 微软雅黑;
            font-size: 14px;
            cursor: pointer;
            vertical-align: middle;
        }
        
        .button1:hover
        {
            background-color: #00CED1;
            border-color: #00CED1;
            color: White;
        }
        
        /*异常table样式*/
        .table
        {
            border-collapse: collapse;
            border: 1px solid #5C6065;
            width: 100%;
        }
        
        .table td
        {
            border: 1px solid #5C6065;
        }
        
        .trTitle
        {
            background-color: #2C3E48;
            text-align: center;
            font-size: 20px;
            color: White;
            height: 40px;
        }
        .trContent
        {
            text-align: center;
            height: 30px;
        }
        
        /*出样table样式*/
        .SampleTable
        {
            border-collapse: collapse;
            border: 1px solid #5C6065;
            width: 100%;
        }
        .SampleTable td
        {
            border: 1px solid #5C6065;
        }
        
        .trSampleTitle
        {
            background-color: #2C3E48;
            text-align: center;
            font-size: 17px;
            font-family: 微软雅黑;
            color: White;
            height: 36px;
        }
        .trSampleContent
        {
            text-align: center;
            height: 34px;
            color: White;
        }
    </style>
</head>
<body onload="initpage()" style="background-color: #231F20;" onselectstart="return false;">
    <div class="div-root" id="divCanvas">
        <div id="sambox" style="width: 668px; height: 450px; position: absolute; top: 550px;
            left: 77px;">
        </div>
        <embed id="svgCanvas1" src="Resources/AutoCupboardPneumaticTransfer.svg" type="image/svg+xml" />
    </div>
    <div id="createtable" style="width: 800px; height: 385px; display: none; overflow: auto;">
    </div>
    <input type="text" id="displayvalue" value="123" style="display: none;" />
</body>
</html>
